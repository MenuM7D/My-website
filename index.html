<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رفع الصور وتحويلها إلى روابط</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
</head>
<body>
    <div class="container">
        <h1>رفع الصور وتحويلها إلى روابط</h1>
        
        <input type="file" id="fileInput" multiple accept="image/*">
        <label for="fileInput" class="upload-btn">اختيار الصور</label>
        
        <!-- سيتم عرض رسالة جاري التحميل وعلامة التحميل هنا -->
        <div id="loadingMessage" class="loading-message" style="display:none;">
            جاري التحميل... <div class="spinner"></div>
        </div>

        <!-- عرض الروابط هنا -->
        <div id="linksContainer" class="links-container"></div>
        
        <!-- زر نسخ الروابط -->
        <button id="copyLinksBtn" class="copy-btn" style="display:none;">نسخ جميع الروابط</button>
        
        <!-- زر تثبيت التطبيق -->
        <button id="installButton" style="display:none;">تثبيت التطبيق</button>

        <!-- زر إضافة إلى الشاشة الرئيسية -->
        <button id="addToHomeButton" style="display:none;">إضافة إلى الشاشة الرئيسية</button>
    </div>

    <script src="script.js"></script>

    <script>
        let deferredPrompt;

        // تحقق إذا كان الموقع يعمل كـ PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then(() => console.log('Service Worker مسجل بنجاح'))
                .catch(err => console.error('فشل التسجيل:', err));
        }

        // مراقبة حدث "قبل التثبيت"
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installButton').style.display = 'block';  // إظهار زر التثبيت
        });

        // التعامل مع زر التثبيت
        document.getElementById('installButton').addEventListener('click', () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('تم قبول التثبيت');
                    } else {
                        console.log('تم رفض التثبيت');
                    }
                    deferredPrompt = null;
                });
            }
        });

        // التعامل مع زر "إضافة إلى الشاشة الرئيسية"
        if (window.matchMedia('(display-mode: standalone)').matches) {
            document.getElementById('addToHomeButton').style.display = 'none'; // إخفاء زر "إضافة إلى الشاشة الرئيسية" إذا كان الموقع مثبتًا
        } else {
            document.getElementById('addToHomeButton').style.display = 'block';  // إظهار زر "إضافة إلى الشاشة الرئيسية"
        }

        document.getElementById('addToHomeButton').addEventListener('click', () => {
            if (navigator.share) {
                // إذا كان دعم مشاركة (share) متاح
                navigator.share({
                    title: 'رفع الصور وتحويلها إلى روابط',
                    url: window.location.href
                }).then(() => console.log('تمت المشاركة بنجاح'))
                .catch((err) => console.error('فشل المشاركة:', err));
            }
        });
    </script>

</body>
</html>
